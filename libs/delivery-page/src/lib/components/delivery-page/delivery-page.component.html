<form class="form-delivery" [formGroup]="form" (ngSubmit)="onSubmit($event)">
  <h4 class="h4 mb16">Информация о доставке</h4>

  <label class="tt-control-label mb8">
    Тип получателя
    <select class="tt-input" formControlName="type">
      <option [value]="ReceiverType.PERSON">Физическое лицо</option>
      <option [value]="ReceiverType.LEGAL">Юридическое лицо</option>
    </select>
  </label>

  <div>
    <label class="tt-control-label mb8">
      Name
      <input type="text" class="tt-input" placeholder="Введите имя" formControlName="name">
      <!--            <small class="validation">Это поле обязательно!</small>-->
    </label>
    <div *ngIf="form.controls.name.touched && form.controls.name.hasError('required')"></div>
    @if (form.controls.name.touched && form.controls.name.hasError('required')) {
      <small class="form-delivery__error">Это поле обязательно!</small>
    }
    @if (form.controls.name.touched && form.controls.name.hasError('startsWitch')) {
      <small class="form-delivery__error">{{ form.controls.name.getError('startsWitch') }}</small>
    }

  </div>

  @if (form.controls.type.value === ReceiverType.LEGAL) {
    <label class="tt-control-label mb8">
      ИНН
      <input type="text" class="tt-input" placeholder="Введите ИНН" formControlName="inn">
    </label>
  } @else {
    <label class="tt-control-label mb8">
      LastName
      <input type="text" class="tt-input" placeholder="Введите фамилию" formControlName="lastName">
    </label>
  }


  <div class="address">
    <div class="address__wrapper-btn">
      <h4 class="address__header">Адрес доставки</h4>
      <div class="address__btn btn" (click)="addAddress()">+</div>
    </div>

    @for (group of form.controls.addresses.controls; track group; let i = $index; ) {
      <div class="address__wrapper" [formGroup]="group">
        <label class="tt-control-label">
          Город
          <input type="text" class="tt-input" placeholder="Город" formControlName="city">
        </label>

        <label class="tt-control-label">
          Улица
          <input type="text" class="tt-input" placeholder="Улица" formControlName="street">
        </label>

        <label class="tt-control-label">
          Дом
          <input type="text" class="tt-input" placeholder="Дом" formControlName="building">
        </label>

        <label class="tt-control-label">
          Квартира
          <input type="text" class="tt-input" placeholder="Квартира" formControlName="apartment">
        </label>

        <button
          class="address__delete btn"
          (click)="deleteAddress(i)"
        >Удалить
        </button>
      </div>
    }
  </div>

  <div class="feature" [formGroup]="form.controls.feature">
    <h4 class="feature__header">Дополнительно</h4>

    @for (control of form.controls.feature.controls | keyvalue: sort; track control; let i = $index) {
      <div class="feature__wrapper">
        <label class="feature__content">
          {{ features[i].label }}
          <input type="checkbox" [formControlName]="control.key">
        </label>
      </div>
    }
  </div>

  <button
    class="btn btn-shadow mt20"
    type="submit"
  >Подтвердить
  </button>
</form>
