{"version":3,"file":"chat-ws-rxjs.service.js","sourceRoot":"","sources":["../../../../../../../../data-access/src/lib/chats/services/chat-ws-rxjs.service.ts"],"names":[],"mappings":"AASA,OAAO,EAAE,SAAS,EAAE,MAAM,gBAAgB,CAAC;AAC3C,OAAO,EAAE,QAAQ,EAAE,GAAG,EAAE,MAAM,MAAM,CAAC;AAErC,MAAM,OAAO,iBAAiB;IAC5B,OAAO,GAA2C,IAAI,CAAC;IAEvD,OAAO,CAAC,MAA8B;QACpC,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;YACjB,IAAI,CAAC,OAAO,GAAG,SAAS,CAAC;gBACvB,GAAG,EAAE,MAAM,CAAC,GAAG;gBACf,QAAQ,EAAE,CAAC,MAAM,CAAC,KAAK,CAAC;aACzB,CAAC,CAAC;SACJ;QAED,OAAO,IAAI,CAAC,OAAO,CAAC,YAAY,EAAE,CAAC,IAAI,CACrC,GAAG,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,MAAM,CAAC,aAAa,CAAC,OAA+B,CAAC,CAAC,EACvE,QAAQ,CAAC,GAAG,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,CAC1C,CAAC;IACJ,CAAC;IAED,UAAU;QACR,IAAI,CAAC,OAAO,EAAE,QAAQ,EAAE,CAAC;QACzB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;IACtB,CAAC;IAED,WAAW,CAAC,IAAY,EAAE,MAAc;QACtC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC;YACjB,IAAI;YACJ,OAAO,EAAE,MAAM;SAChB,CAAC,CAAC;IACL,CAAC;CACF","sourcesContent":["import {\n  ChatConnectionWSParams,\n  ChatWsService,\n} from '@tt/interfaces/chats/chat-ws-service.interface';\nimport { WebSocketSubject } from 'rxjs/internal/observable/dom/WebSocketSubject';\nimport {\n  ChatWSMessage,\n  ChatWSMessageReceive,\n} from '@tt/interfaces/chats/chat-ws-message.interface';\nimport { webSocket } from 'rxjs/webSocket';\nimport { finalize, tap } from 'rxjs';\n\nexport class ChatWsRxjsService implements ChatWsService {\n  #socket: WebSocketSubject<ChatWSMessage> | null = null;\n\n  connect(params: ChatConnectionWSParams) {\n    if (!this.#socket) {\n      this.#socket = webSocket({\n        url: params.url,\n        protocol: [params.token],\n      });\n    }\n\n    return this.#socket.asObservable().pipe(\n      tap((message) => params.handleMessage(message as ChatWSMessageReceive)),\n      finalize(() => console.log('Чат закрыт'))\n    );\n  }\n\n  disconnect(): void {\n    this.#socket?.complete();\n    this.#socket = null;\n  }\n\n  sendMessage(text: string, chatId: number): void {\n    this.#socket?.next({\n      text,\n      chat_id: chatId,\n    });\n  }\n}\n"]}