{"version":3,"file":"auth.service.js","sourceRoot":"","sources":["../../../../../../../../data-access/src/lib/auth/services/auth.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { HttpClient } from '@angular/common/http';\r\nimport { inject, Injectable } from '@angular/core';\r\nimport { catchError, tap, throwError } from 'rxjs';\r\nimport { CookieService } from 'ngx-cookie-service';\r\nimport { Router } from '@angular/router';\r\nimport { TokenResponse } from '@tt/interfaces/auth';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class AuthService {\r\n  http = inject(HttpClient);\r\n  router = inject(Router);\r\n  cookieService = inject(CookieService);\r\n  baseApiUrl = '/yt-course/auth/';\r\n\r\n  token: string | null = null;\r\n  refreshToken: string | null = null;\r\n\r\n  get isAuth() {\r\n    if (!this.token) {\r\n      this.token = this.cookieService.get('token');\r\n      this.refreshToken = this.cookieService.get('refreshToken');\r\n    }\r\n    return !!this.token;\r\n  }\r\n\r\n  login(payload: { username: string; password: string }) {\r\n    const fd = new FormData();\r\n\r\n    fd.append('username', payload.username);\r\n    fd.append('password', payload.password);\r\n\r\n    return this.http\r\n      .post<TokenResponse>(`${this.baseApiUrl}token`, fd)\r\n      .pipe(tap((val) => this.saveTokens(val)));\r\n  }\r\n\r\n  refreshAuthToken() {\r\n    return this.http\r\n      .post<TokenResponse>(`${this.baseApiUrl}refresh`, {\r\n        refresh_token: this.refreshToken,\r\n      })\r\n      .pipe(\r\n        tap((val) => this.saveTokens(val)),\r\n        catchError((err) => {\r\n          this.logout();\r\n\r\n          return throwError(err);\r\n        })\r\n      );\r\n  }\r\n\r\n  logout() {\r\n    this.cookieService.deleteAll;\r\n    this.token = null;\r\n    this.refreshToken = null;\r\n    this.router.navigate(['/login']);\r\n  }\r\n\r\n  saveTokens(res: TokenResponse) {\r\n    this.token = res.access_token;\r\n    this.refreshToken = res.refresh_token;\r\n\r\n    this.cookieService.set('token', this.token, { path: '/' });\r\n    this.cookieService.set('refreshToken', this.refreshToken, { path: '/' });\r\n  }\r\n}\r\n"]}