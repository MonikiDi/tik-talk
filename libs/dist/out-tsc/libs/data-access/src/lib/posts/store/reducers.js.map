{"version":3,"file":"reducers.js","sourceRoot":"","sources":["../../../../../../../../data-access/src/lib/posts/store/reducers.ts"],"names":[],"mappings":"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","sourcesContent":["import { createFeature, createReducer, on } from '@ngrx/store';\r\nimport { Post } from '@tt/interfaces/post';\r\nimport { postsActions } from './actions';\r\n\r\nexport type PostsMap = Record<string, Post>;\r\nexport type UserIdPostsIdMap = Record<string, number[]>;\r\n\r\nexport interface PostsState {\r\n  posts: PostsMap;\r\n  userIdPostsId: UserIdPostsIdMap;\r\n}\r\n\r\nconst initialState: PostsState = {\r\n  posts: {},\r\n  userIdPostsId: {}\r\n};\r\n\r\nexport const postsFeature = createFeature({\r\n  name: 'postsFeature',\r\n  reducer: createReducer(\r\n    initialState,\r\n    // on(postsActions.loadedPosts, (state, payload) => {\r\n    //   return {\r\n    //     ...state,\r\n    //     posts: payload.posts\r\n    //   };\r\n    // }),\r\n    on(postsActions.deletedPost, (state, payload) => {\r\n      const userId = state.posts[payload.postId].author.id;\r\n\r\n      return {\r\n        ...state,\r\n        posts: {\r\n          ...Object.fromEntries(\r\n            Object.entries(state.posts).filter(\r\n              ([key, value]) => key !== String(payload.postId)\r\n            )\r\n          )\r\n        },\r\n        userIdPostsId: {\r\n          ...state.userIdPostsId,\r\n          [userId]: state.userIdPostsId[userId].filter((element) => {\r\n            return element !== payload.postId;\r\n          })\r\n        }\r\n      };\r\n    }),\r\n    on(postsActions.createdPost, (state, payload) => {\r\n      return {\r\n        ...state,\r\n        posts: {\r\n          ...state.posts,\r\n          [payload.id]: payload\r\n        },\r\n        userIdPostsId: {\r\n          ...state.userIdPostsId,\r\n          [payload.author.id]: [\r\n            ...state.userIdPostsId[payload.author.id],\r\n            payload.id\r\n          ]\r\n        }\r\n      };\r\n    }),\r\n    on(postsActions.loadedPostsUserId, (state, payload) => {\r\n      return {\r\n        ...state,\r\n        posts: {\r\n          ...state.posts,\r\n          ...payload.userPosts.reduce((acc, item) => {\r\n            return { ...acc, [item.id]: item };\r\n          }, {} as PostsMap)\r\n        },\r\n        userIdPostsId: {\r\n          ...state.userIdPostsId,\r\n          ...payload.userPosts.reduce((acc, item) => {\r\n            if (item.author.id in acc) {\r\n              acc[item.author.id].push(item.id);\r\n              return {\r\n                ...acc\r\n              };\r\n            } else {\r\n              return { ...acc, [item.author.id]: [item.id] };\r\n            }\r\n          }, {} as UserIdPostsIdMap)\r\n        }\r\n      };\r\n    }),\r\n    on(postsActions.updatePosts, (state, payload) => {\r\n      const postId = payload.post.id;\r\n      return {\r\n        ...state,\r\n        posts: {\r\n          ...state.posts,\r\n          [postId]:\r\n            state.posts[postId].id === postId\r\n              ? payload.post\r\n              : state.posts[postId].id\r\n        }\r\n      };\r\n    }),\r\n    on(postsActions.createdComment, (state, payload) => {\r\n      const postId = payload.postId;\r\n      return {\r\n        ...state,\r\n        posts: {\r\n          ...state.posts,\r\n          [postId]: {\r\n            ...state.posts[postId],\r\n            comments: [...state.posts[postId].comments, payload]\r\n          }\r\n        }\r\n      };\r\n    }),\r\n    on(postsActions.deletedComment, (state, payload) => {\r\n      const postId = payload.postId;\r\n      const commentId = payload.commentId;\r\n\r\n      return {\r\n        ...state,\r\n        posts: {\r\n          ...state.posts,\r\n          [postId]: {\r\n            ...state.posts[postId],\r\n            comments: [\r\n              ...state.posts[postId].comments.filter((element) => {\r\n                return element.id !== commentId;\r\n              })\r\n            ]\r\n          }\r\n        }\r\n      };\r\n    }),\r\n    on(postsActions.editedPost, (state, payload) => {\r\n      const postId = payload.id;\r\n      return {\r\n        ...state,\r\n        posts: {\r\n          ...state.posts,\r\n          [postId]: {\r\n            ...state.posts[postId],\r\n            content: payload.content,\r\n            title: payload.title,\r\n          },\r\n        },\r\n      };\r\n    })\r\n  )\r\n});\r\n"]}