{"version":3,"file":"post-feed.component.js","sourceRoot":"","sources":["../../../../../../../../posts/src/lib/feature-posts-wall/post-feed/post-feed.component.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  AfterViewInit,\n  ChangeDetectionStrategy,\n  Component,\n  computed,\n  ElementRef,\n  HostListener,\n  inject,\n  input,\n  Renderer2,\n  signal,\n} from '@angular/core';\n\nimport { PostInputComponent } from '../../ui/post-input/post-input.component';\nimport { PostComponent } from '../post/post.component';\nimport { assertNonNullish, Debounce, normalizationText } from '@tt/shared';\nimport { Store } from '@ngrx/store';\nimport { postsActions, selectProfileMe } from '@tt/data-access';\nimport { ActivatedRoute } from '@angular/router';\nimport { Post } from '@tt/interfaces/post';\nimport { AsyncPipe } from '@angular/common';\n\n@Component({\n  selector: 'app-post-feed',\n  standalone: true,\n  imports: [PostInputComponent, PostComponent, AsyncPipe],\n  templateUrl: './post-feed.component.html',\n  styleUrl: './post-feed.component.scss',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class PostFeedComponent implements AfterViewInit {\n  private readonly activatedRoute = inject(ActivatedRoute);\n  private readonly store = inject(Store);\n  public hostElement = inject(ElementRef);\n  public r2 = inject(Renderer2);\n\n  public posts = input.required<Post[]>();\n  public profile = this.store.selectSignal(selectProfileMe);\n  public hasMe = this.activatedRoute.snapshot.params['id'] === undefined;\n  public userId = '';\n\n  public sortPosts = computed(() => {\n    const postsArray = Object.values(this.posts());\n    return postsArray.slice().sort((a, b) => {\n      return a.createdAt > b.createdAt ? -1 : 1;\n    });\n  });\n\n  public parentData = signal('');\n\n  ngAfterViewInit() {\n    this.resizeFeed();\n  }\n\n  // 1 Метод c debounceTime\n  // private readonly resize = new Subject<void>()\n  //\n  // @HostListener('window: resize')\n  // public onWindowResize() {\n  //   this.resize.next(undefined)\n  // }\n  // private subscription: Subscription = Subscription.EMPTY;\n  // public ngOnInit() {\n  //   this.subscription =  this.resize.pipe(debounceTime(20)).subscribe(() => {\n  //     this.resizeFeed()\n  //\n  //\n  //   })\n  //   console.log('subscribe')\n  // }\n  // public ngOnDestroy(): void {\n  //   this.subscription.unsubscribe();\n  //   console.log('unsubscribe')\n  // }\n\n  // 2 Метод c Декоратором\n  @Debounce(20)\n  @HostListener('window: resize')\n  onWindowResize() {\n    this.resizeFeed();\n  }\n\n  // 3 Метод с функцией debounce\n  // @HostListener('window: resize')\n  // onWindowResize() {\n  //   this.func()\n  // }\n  // public func = this.debounce(this.resizeFeed.bind(this), 20)\n  // public debounce<Params extends any[]>(\n  //   func: (...args: Params) => any,\n  //   timeout: number,\n  // ): (...args: Params) => void {\n  //   let timer: any\n  //   return (...args: Params) => {\n  //     clearTimeout(timer)\n  //     timer = setTimeout(() => {\n  //       func(...args)\n  //     }, timeout)\n  //   }\n  // }\n\n  public resizeFeed() {\n    const { top } = this.hostElement.nativeElement.getBoundingClientRect();\n    const height = window.innerHeight - top - 48;\n    this.r2.setStyle(this.hostElement.nativeElement, 'height', `${height}px`);\n    // console.log(height);\n  }\n\n  onCreatePost(text: string) {\n    const profile = this.profile();\n    const result = normalizationText(text);\n    assertNonNullish(profile, '');\n    assertNonNullish(result, '');\n    if (this.parentData() === '' || result === '') {\n      this.parentData.set('');\n      return;\n    }\n    this.store.dispatch(\n      postsActions.createPost({\n        title: 'Клевый пост',\n        content: result,\n        authorId: profile.id,\n        communityId: 0,\n      })\n    );\n    this.parentData.set('');\n  }\n}\n"]}