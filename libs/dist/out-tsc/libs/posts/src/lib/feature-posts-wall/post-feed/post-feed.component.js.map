{"version":3,"file":"post-feed.component.js","sourceRoot":"","sources":["../../../../../../../../posts/src/lib/feature-posts-wall/post-feed/post-feed.component.ts"],"names":[],"mappings":"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","sourcesContent":["import {\r\n  AfterViewInit,\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  computed,\r\n  ElementRef,\r\n  HostListener,\r\n  inject,\r\n  input,\r\n  Renderer2,\r\n  signal,\r\n} from '@angular/core';\r\n\r\nimport { PostInputComponent } from '../../ui/post-input/post-input.component';\r\nimport { PostComponent } from '../post/post.component';\r\nimport { assertNonNullish, Debounce, normalizationText } from '@tt/shared';\r\nimport { Store } from '@ngrx/store';\r\nimport { postsActions, selectProfileMe } from '@tt/data-access';\r\nimport { ActivatedRoute } from '@angular/router';\r\nimport { Post } from '@tt/interfaces/post';\r\nimport { AsyncPipe } from '@angular/common';\r\n\r\n@Component({\r\n  selector: 'app-post-feed',\r\n  standalone: true,\r\n  imports: [PostInputComponent, PostComponent, AsyncPipe],\r\n  templateUrl: './post-feed.component.html',\r\n  styleUrl: './post-feed.component.scss',\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class PostFeedComponent implements AfterViewInit {\r\n  private readonly activatedRoute = inject(ActivatedRoute);\r\n  public hostElement = inject(ElementRef);\r\n  private readonly store = inject(Store);\r\n  public r2 = inject(Renderer2);\r\n\r\n  public posts = input.required<Post[]>();\r\n  public profile = this.store.selectSignal(selectProfileMe);\r\n  public hasMe = this.activatedRoute.snapshot.params['id'] === undefined;\r\n  public userId = '';\r\n\r\n  public sortPosts = computed(() => {\r\n    const postsArray = Object.values(this.posts());\r\n    return postsArray.slice().sort((a, b) => {\r\n      return a.createdAt > b.createdAt ? -1 : 1;\r\n    });\r\n  });\r\n\r\n  public parentData = signal('');\r\n\r\n  ngAfterViewInit() {\r\n    this.resizeFeed();\r\n  }\r\n\r\n  // 1 Метод c debounceTime\r\n  // private readonly resize = new Subject<void>()\r\n  //\r\n  // @HostListener('window: resize')\r\n  // public onWindowResize() {\r\n  //   this.resize.next(undefined)\r\n  // }\r\n  // private subscription: Subscription = Subscription.EMPTY;\r\n  // public ngOnInit() {\r\n  //   this.subscription =  this.resize.pipe(debounceTime(20)).subscribe(() => {\r\n  //     this.resizeFeed()\r\n  //\r\n  //\r\n  //   })\r\n  //   console.log('subscribe')\r\n  // }\r\n  // public ngOnDestroy(): void {\r\n  //   this.subscription.unsubscribe();\r\n  //   console.log('unsubscribe')\r\n  // }\r\n\r\n  // 2 Метод c Декоратором\r\n  @Debounce(20)\r\n  @HostListener('window: resize')\r\n  onWindowResize() {\r\n    this.resizeFeed();\r\n  }\r\n\r\n  // 3 Метод с функцией debounce\r\n  // @HostListener('window: resize')\r\n  // onWindowResize() {\r\n  //   this.func()\r\n  // }\r\n  // public func = this.debounce(this.resizeFeed.bind(this), 20)\r\n  // public debounce<Params extends any[]>(\r\n  //   func: (...args: Params) => any,\r\n  //   timeout: number,\r\n  // ): (...args: Params) => void {\r\n  //   let timer: any\r\n  //   return (...args: Params) => {\r\n  //     clearTimeout(timer)\r\n  //     timer = setTimeout(() => {\r\n  //       func(...args)\r\n  //     }, timeout)\r\n  //   }\r\n  // }\r\n\r\n  public resizeFeed() {\r\n    const { top } = this.hostElement.nativeElement.getBoundingClientRect();\r\n    const height = window.innerHeight - top - 48;\r\n    this.r2.setStyle(this.hostElement.nativeElement, 'height', `${height}px`);\r\n    // console.log(height);\r\n  }\r\n\r\n  onCreatePost(text: string) {\r\n    const profile = this.profile();\r\n    const result = normalizationText(text);\r\n    assertNonNullish(profile, '');\r\n    assertNonNullish(result, '');\r\n    if (this.parentData() === '' || result === '') {\r\n      this.parentData.set('');\r\n      return;\r\n    }\r\n    this.store.dispatch(\r\n      postsActions.createPost({\r\n        title: 'Клевый пост',\r\n        content: result,\r\n        authorId: profile.id,\r\n        communityId: 0,\r\n      })\r\n    );\r\n    this.parentData.set('');\r\n  }\r\n}\r\n"]}