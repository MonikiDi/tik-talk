{"version":3,"file":"post.component.js","sourceRoot":"","sources":["../../../../../../../../posts/src/lib/feature-posts-wall/post/post.component.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  ChangeDetectionStrategy,\n  Component,\n  computed,\n  DestroyRef,\n  ElementRef,\n  inject,\n  input,\n  signal,\n  ViewChild,\n} from '@angular/core';\nimport { catchError, throwError } from 'rxjs';\nimport {\n  assertNonNullish,\n  DataCreateAtPipe,\n  normalizationText,\n} from '@tt/shared';\nimport { CommentComponent, PostInputComponent } from '../../ui';\nimport { AvatarCircleComponent, SvgIconComponent } from '@tt/common-ui';\nimport { Post } from '@tt/interfaces/post';\nimport { Store } from '@ngrx/store';\nimport { postsActions, PostService, selectProfileMe } from '@tt/data-access';\nimport { NgClass } from '@angular/common';\nimport { HttpErrorResponse } from '@angular/common/http';\nimport { takeUntilDestroyed } from '@angular/core/rxjs-interop';\nimport { EditPostComponent } from '../edit-post/edit-post.component';\n\n@Component({\n  selector: 'app-post',\n  standalone: true,\n  imports: [\n    AvatarCircleComponent,\n    SvgIconComponent,\n    PostInputComponent,\n    CommentComponent,\n    DataCreateAtPipe,\n    NgClass,\n    EditPostComponent,\n  ],\n  templateUrl: './post.component.html',\n  styleUrl: './post.component.scss',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class PostComponent {\n  private readonly postService = inject(PostService);\n  private readonly destroyRef = inject(DestroyRef);\n  private readonly store = inject(Store);\n  public post = input.required<Post>();\n  public hasMe = input<boolean>();\n  public profile = this.store.selectSignal(selectProfileMe);\n  public parentData = signal('');\n  public isActiveComments = false;\n  public likes = computed(() => {\n    return this.post().likes;\n  });\n  public comments = computed(() => {\n    return this.post().comments;\n  });\n  public showEdit = false;\n\n  onDeletePost(postId: number) {\n    this.store.dispatch(postsActions.deletePost({ postId }));\n  }\n\n  onCreateCommit(text: string) {\n    const profile = this.profile();\n    const result = normalizationText(text);\n    const post = this.post();\n    assertNonNullish(profile, '');\n    assertNonNullish(result, '');\n    assertNonNullish(post, '');\n\n    if (this.parentData() === '' || result === '') {\n      this.parentData.set('');\n      return;\n    }\n\n    this.store.dispatch(\n      postsActions.createComment({\n        text: result,\n        authorId: profile.id,\n        postId: post.id,\n        commentId: 0,\n      })\n    );\n    this.parentData.set('');\n\n    // firstValueFrom(\n    //   this.postService.createComment({\n    //     text: result,\n    //     authorId: profile.id,\n    //     postId: post.id,\n    //     commentId: 0,\n    //   })\n    // )\n    //   .then(() => {\n    //     return firstValueFrom(\n    //       this.postService.getCommentPostId(this.post()!.id)\n    //     );\n    //   })\n    //   .then((comments) => {\n    //     this.comments.set(comments);\n    //     this.parentData.set('');\n    //   });\n  }\n\n  toggleLikes(post: Post) {\n    this.postService\n      .addLike(post.id)\n      .pipe(\n        catchError((error: HttpErrorResponse) => {\n          if (error.error.detail === 'Like is already created') {\n            return this.postService.deleteLike(post.id);\n          }\n          return throwError(() => {\n            return error;\n          });\n        }),\n        takeUntilDestroyed(this.destroyRef)\n      )\n      .subscribe((response) => {\n        this.store.dispatch(\n          postsActions.updatePosts({\n            post: {\n              ...this.post(),\n              likes:\n                response.message === 'Like created'\n                  ? this.post().likes + 1\n                  : this.post().likes - 1,\n            },\n          })\n        );\n      });\n  }\n\n  toggleComment() {\n    if (this.post()!.comments.length >= 0) {\n      this.isActiveComments = !this.isActiveComments;\n    }\n  }\n\n  onEditPost() {\n    this.showEdit = !this.showEdit;\n  }\n\n  showEditEvent(showEdit: boolean) {\n    this.showEdit = showEdit;\n  }\n}\n"]}