{"version":3,"file":"settings-page.component.js","sourceRoot":"","sources":["../../../../../../../../profile/src/lib/feature-profile-settings/settings-page/settings-page.component.ts"],"names":[],"mappings":"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","sourcesContent":["import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  effect,\r\n  inject,\r\n  ViewChild,\r\n} from '@angular/core';\r\nimport { ProfileHeaderComponent } from '../../ui/profile-header/profile-header.component';\r\nimport { FormBuilder, ReactiveFormsModule, Validators } from '@angular/forms';\r\nimport { RouterLink } from '@angular/router';\r\nimport { AsyncPipe } from '@angular/common';\r\nimport { AvatarUploadComponent } from '../../ui/avatar-upload/avatar-upload.component';\r\nimport { TasksComponent } from '@tt/common-ui';\r\nimport { AboutMeComponent } from '@tt/common-ui';\r\nimport { Store } from '@ngrx/store';\r\nimport { profileActions, selectProfileMe } from '@tt/data-access';\r\n\r\n@Component({\r\n  selector: 'app-settings-page',\r\n  standalone: true,\r\n  imports: [\r\n    ProfileHeaderComponent,\r\n    ReactiveFormsModule,\r\n    RouterLink,\r\n    AsyncPipe,\r\n    AvatarUploadComponent,\r\n    TasksComponent,\r\n    AboutMeComponent,\r\n  ],\r\n  templateUrl: './settings-page.component.html',\r\n  styleUrl: './settings-page.component.scss',\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class SettingsPageComponent {\r\n  fb = inject(FormBuilder);\r\n  store = inject(Store);\r\n  profile$ = this.store.select(selectProfileMe);\r\n\r\n  @ViewChild(AvatarUploadComponent) avatarUploader!: AvatarUploadComponent;\r\n\r\n  form = this.fb.group({\r\n    firstName: ['', Validators.required],\r\n    lastName: ['', Validators.required],\r\n    username: [{ value: '', disabled: true }, Validators.required],\r\n    description: [''],\r\n    city: [''],\r\n    stack: [''],\r\n  });\r\n\r\n  constructor() {\r\n    effect(() => {\r\n      this.form.patchValue({\r\n        ...this.store.selectSignal(selectProfileMe)(),\r\n        stack: this.mergeStack(\r\n          this.store.selectSignal(selectProfileMe)()?.stack\r\n        ),\r\n      });\r\n    });\r\n  }\r\n\r\n  onSave() {\r\n    this.form.markAllAsTouched();\r\n    this.form.updateValueAndValidity();\r\n\r\n    if (this.form.invalid) return;\r\n\r\n    if (this.avatarUploader.avatar) {\r\n      this.store.dispatch(\r\n        profileActions.loadPatchAvatarMe({ file: this.avatarUploader.avatar })\r\n      );\r\n    }\r\n\r\n    this.store.dispatch(\r\n      profileActions.loadPatchMe({\r\n        firstName: this.form.value.firstName || undefined,\r\n        lastName: this.form.value.lastName || undefined,\r\n        username: this.form.value.username || undefined,\r\n        description: this.form.value.description || undefined,\r\n        city: this.form.value.city || undefined,\r\n        stack: this.splitStack(this.form.value.stack),\r\n      })\r\n    );\r\n  }\r\n\r\n  splitStack(stack: string | null | string[] | undefined): string[] {\r\n    if (!stack) return [];\r\n    if (Array.isArray(stack)) return stack;\r\n\r\n    return stack.split(',');\r\n  }\r\n\r\n  mergeStack(stack: string | null | string[] | undefined) {\r\n    if (!stack) return '';\r\n    if (Array.isArray(stack)) return stack.join(',');\r\n\r\n    return stack;\r\n  }\r\n}\r\n"]}